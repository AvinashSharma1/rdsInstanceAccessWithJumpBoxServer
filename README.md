# Rds Instance Access with JumpBox server

>## how to access any type of RDS (MySQL, Postgres, MSSQL) or Aurora Database located in a private subnet?

 >I show you how to setup your VPC for connectivity, create an EC2 JumpBox in a public subnet, create a RDS Postgres database in a private subnet, and finally access it from your HOME machine using MySqlWorkBench. 
 
 ##### Content This is a step by step walkthrough that shows you all the steps and explains relevant settings along the way. 

###  [Youtube Link video](https://www.youtube.com/watch?v=buqBSiEEdQc&t=1581s)

> Hello everyone. In this video, I'm going to show you how to connect to an RDS or a Rora instance that's located in a private subnet in your VPC. Now before getting into the AWS console and showing you how to set this up, I wanted to do a brief little overview of what exactly is going on here and what are the steps that we need to do. So first of all, we're going to be interacting in the default VPC that comes with your AWS account. And with it, you get access to a public subnet like we have over here on the left hand side. Now one of the steps that we're going to need to do is we're going to need to create a private subnet as well. This subnet is not going to have access to the public internet. And the only way that it's going to be able to connect with the outside world is through something called an SSH tunnel, which we'll be using later. Now our RDS instance is going to be placed into our private subnet so that we can shield it from the internet. However, we do need a way to access it using tools like PG admin or whatever kind of IDE that you use from your home. network. And for that, we need something called a jump box. So what we're going to do is create a jump box in our public subnet. And sometimes you hear the term bash and host or jump box. These are used interchangeably. And this is just going to be a very small T3 or T2 micro instance that we place in our public subnet and configure our subnet so that it can be accessed from the public internet on our home network. Now when we create our EC2 instance, there is something that's called a security group that gets associated with it. We're going to need to modify the rules of the security group, like you can see over here on the left to allow in bounce SSH connections from the public internet. And you can either make this so that it's from anywhere on the public internet or restrict that to just your IP address or a range of IP addresses. If you're on your home network, your IP address can change from time to time. So you may want to be aware of that before picking one option or the other. So once we set up that EC2 jump box and the security group, we're going to test everything out to make sure that we can SSH into it from our home machine. After we've established that, we're going to be able to create our RDS database in our private subnet. And similarly, that RDS database will also have a security group. And this part is where most folks get stuck because you would think that the RDS database in its private subnet is now able to talk to the EC2 machine in the public subnet. That's not the case. You need to modify the security group of the RDS database instance to allow SSH connections from the Bastion EC2 security group. So these two things are related, the EC2 security group and the RDS security group. We need to effectively whitelist the Bastion host security group so that it can interact with the RDS instances security group. If that doesn't make sense to you right now, don't worry about it. It's going to make sense when we get to it a little bit later. So after we've completed all these steps, we're going to test all this out. We are going to be on our home network like I am right now. And we're going to form an SSH tunnel that goes from our home machine through our Bastion jump box and into our RDS instance. And from there, we're going to be able to use tools like PG admin or data grip or whatever type of IDE that you use to interact with your database as if it was on your home machine. So that's the agenda for this video. The first thing we're going to do is we're going to do all the network connectivity stuff. So we're going to talk about the VPC and create our private subnets. Then we're going to create our jump box and ensure connectivity is working. Then we're going to create our RDS database and make sure all of that is set up correctly and then finally test everything out using PG admin. So that's what we're going to do in this video. I'll see you over in the console. All right, everyone. So here we are in the AWS console. So the first thing that you're going to want to do is head over into the VPC section of the console and get started creating our subnets. So I'm just going to type in VPC here in the top search bar and click on VPC here to bring us to the homepage. And if you want to just click on your VPCs on the left hand side here, you should see the default AWS VPC. I should just have one entry if you've done nothing with your AWS account so far. And I gave this a custom name here. You can do that by just clicking on this pencil icon and giving it a name. You'll find that naming of your subnets of your VPC of your security groups. That's all very, very important when it comes to networking because it's very easy to lose track of what is doing what and having good names makes it a lot easier for you. Trust me. I've been there. So with the default AWS VPC, you get a bunch of things for free. What you get for free are public subnets for this VPC in every AWS availability zone in the region. So for example, I'm in North Virginia right now, which is US East one. If you go into the subnet section of the console and remember that our VPC ID is starts with 2.9A here, we go into the subnet section. You should see a bunch of items here. And yes, you can see them. So these are all different subnets that correspond to different availability zones within the region. And we can figure out which one belongs to which by scrolling to the right here and looking at the availability zones. So the first one is 1a 1b 1c d e and F. Now if you go into another region, for example, if I were to switch to Ireland, for example, which is EU West 1, you would see different availability zones for your public subnets in your default VPC. You would see US 1a US 1b 1c and however many availability zones there are, that's how many public subnets that you have. Now there is this concept of cider block notation with regards to subnet. So you can see here if we sort these in descending order, the first subnet has 172.31.0.0 slash 20. The second one starts at 16.0, third one starts at 32. You can see it's incrementing in 16 digits per subnet that we create. And we're going to follow the same pattern when we want to create our private subnets or private subnets are going to be 172.31.96.0 slash 20. And then 172.31.112.0 slash 20. So that's going to give us plenty of IP address space for any project that you're going to be running with. Now another thing that comes for free as part of the default VPC if we go back to it over here and we should be able to see, yeah, so it's associated with the main route table right now. And the road table is a VPC specific concept that establishes kind of network rules in terms of what type of network communication is allowed to occur on the subnet. There's a main route table which by default applies to every subnet that exists. You can also create your own route tables that apply to specific subnets that you define within your VPC. So if we look at our main route table and we click on it here and we go to the routes down here, you'll see that this route table has two routes that are available. The first one is destination 0.0 so for zero slash zero and that basically means internet. So any time anything in this network tries to talk to the public internet, it's going to have to flow through the target, which is an internet gateway. So that's desirable for a public subnet. We want anything that's in the public subnet to be able to talk to the public internet. And the second entry here is 172.31.0.0 slash 16 and the target is local. This one is saying that anything within the network can talk to anything else within the network when I say network, I mean VPC here. So when we create our private subnets, we don't want this rule here. This is not something that is going to work for us because we by definition, our private subnets should not be able to talk to the public internet. So we're going to have to create a different route table and associate that with our private subnets in order to set it up correctly. So let's go ahead and do that now. We're going to go into the subnet section of the console here and we're going to go to create subnet in the top right. And we're going to go to create VPC or selective VPC. Make sure you click on the right one. You can see here, this is where the naming becomes important. And it's going to buy default select the side block range for our VPC. That's good. And make sure you give this a good name. So I'm going to call this private dash subnet. And we're going to place this in the availability zone 1a. So I'm going to name it 1a. And then we need to select the availability zone here. So we're going to select 1a. And then we're going to put in that side of block range. So it is 172.31.96.0 slash 20. And that looks good. And we're actually going to create two subnets here. Two private subnets because unfortunately when you create your RDS instance in order to do so, there's a thing called a RDS subnet group. And it needs to have at least two availability zones. So we need to have two different private subnets in order for this to work correctly. So let's do that now. So we're going to do add a new subnet. And we're going to do exactly the same thing. We're going to call this private dash subnet dash 1b because this one is going to be in availability zone 1b. So we're going to select that 1b. And we're going to do the same thing. I guess I can just copy this and put this in there. And we just want to change this to 1.12. And there we go. So let's create these two subnets now. One is completed. Two is completed. There we go. You can see that these have been successfully created. One thing that I wanted to point out is that when you create these subnets by default, they're going to have a setting which is right here. Auto Assign Public IPv4 address is set to know. This is important because if you have this set to true or set to yes, that means that anything that is launched within the subnet is going to get a public IP, which makes it a publicly accessible entity, whether that be an RDS instance or EC2 instance, whatever it may be. So by default comes with no as the setting that's desirable. That's what we want. We're going to leave it as no. All right. So these are the two subnets. Now we can clear the filters just to kind of see what everything looks like. So you see the six original ones that we had up here. And here's 1a and here's 1b. Okay, perfect. So if we let's actually click on one and we can see the route table that it's associated with. This is the default route table that it's associated with. And if you look at the routes, if you remember, this is exactly what we were looking at before. This thing is going to be able to talk to the public internet with this route table entry. So what we want to do is we want to create a custom route table that is not going to allow public internet and is only going to allow intra network connectivity or intra network communication. And then we're going to associate that route table with our two private subnet so that they inherit that behavior. So let's do that now. We're actually already in the route table section. So we don't really need to do much. You can see I already had one that I was playing with before, but we'll create a new one here. And so we're going to go to create route table. Let's call this private demo dash RT and make sure that you select the VPC. And that's all you need to put in for now. So create route table. And you can see by default, it does not have any other routes associated with it, except for this one related to intra network communication. So that's good. That's desirable. But what we want to do now is associate this route table with our two private subnets. So let's go into subnet associations now. And I believe it's yeah, this bottom one here. So edit subnet associations. And you want to click our two private subnets. Again, you can see why naming is important here. So this subnet and this subnet. Go ahead and click on save associations. Okay, so this is looking good now. If we go back to our VPC, nothing really changed here. We go back to our subnets. You can see these are our two private ones at the bottom here. If we scroll to the right, we should be able to see. Yeah, so it has two different road tables now. And you can see our public subnets, which are these top six ones here, all are associated with the main route table. And these bottom two here, which are private subnets, are associated with our private demo route table, which is the one that we just created so far, so good. So we've done everything from the subnet perspective now. We can move on to the EC2 part of this tutorial. So we're going to set up and create that jump box that we're going to place in one of these subnets. I'm going to place it in the availability zone 1a because that's where I'm going to be placing my RDS instance, which is located in the private subnet. So go ahead and do that now. We can go into the EC2 section of the console, so EC2. And we're going to go to instances over here on the left hand side. We're going to click on launch instances in the top right. And we're going to name this, I guess, just jump box. You can name this whatever you want, jump box. You can leave it as Amazon Linux and instance type T2 micro is fine. And this is a free tier eligible instance. So if you have an account that is, I believe less than one year old, you should be able to use this for free for that full year. But if you have an account that's more more old or more season, then you're going to have to pay a very small amount. It's a pretty negligible amount. So I wouldn't really worry about it too much. And then we also need a key pair login. This is going to be helpful for us to SSH into our instance. So we're going to create a new key pair actually. So let's create a new one. And we're going to call this what is it like a private subnet dash demo. Sure. We're going to leave it as RSA and dot pem file. And we're going to create that key pair. And you can see it just got downloaded to my downloads folder when we SSH into our instance. We're going to need to provide this pem file so that it can validate that we have permission to essentially SSH into this instance. So let's close that out now. And let's look at some of these network settings down here. So I'm going to click on edit here because there's some custom things that we want to do. So we want to change the subnet and change some of these different details here. But you can't do that unless you click on edit. So let's click on that now. And for subnet, we want to place this in our public subnet because remember, this is our EC2 instance. This EC2 instance needs to have access to the public internet. So it needs to be placed in a public subnet. So we're going to place it into the subnet that is in availability zone 1a, which is this one here. So we click on that auto assign public IP address. You want this on you want to public IP address because we're going to need something to SSH into. And then for security groups now security groups are the entities that kind of govern at an instance level who or what is going to have access to whatever infrastructure that this security group is associated with. So this security group is going to be for a jump box. So let's just name this jump dash box dash sg. We're going to name it the same thing. And so what we want to do with this security group is you can see it's already kind of setting you up for success here. So it's giving you a type of SSH, which is exactly what we want. It's going to be TCP protocol on port range 22. This is by default set for source type as anywhere. You can also change this to be a custom range of IP addresses or your specific IP address. So if you leave it as anywhere that means anyone on the public internet is going to be able to interact or SSH into this instance. You know, provided they have the pen file. If you put it on my IP, it's going to just whitelist your IP address. However, if your ISP at home changes your IP address regularly like mine does, then you're going to have to come here from time to time once your network kind of starts failing and update this each time. So I like to put it on anywhere, probably not the best security practice if I was in like some kind of production scenario or a work network. I would change this to either custom or my IP address. But for my case, it makes sense to use anywhere. And that's all we need to do for the security group. So I don't think there's anything in advance. Yeah, you don't need to do anything in advance. Nothing for storage, nothing down here. I believe yeah, we're not going to do spot instances. All right. So we can just do launch instance now. And this sometimes take a couple takes a couple moments for it to create and set up and everything. If you go back to the instances section, it should show, yeah, instance state. So it takes a few minutes. I'm going to just pause the video and come back when this is in available states. So I'll see you in a few minutes. All right, everyone. So this only took a minute or so. As you can see, the instance state is currently running. It's doing some status checks now, which are fun. You can let this go. But we should be able to connect to it as is. So what we need to connect to it is it's public IP address. So if you scroll to the right here, you can see it's public IPv4. Address is this value here. So I'm just going to copy. Well, that's not that's a weird right click behavior. I'm just going to copy this to my clipboard so that we can put it into our terminal. So I am using windows for this. But if you're using macro Linux, it's pretty much exactly the same thing. We're just going to need to SSH into our instance and provide our pen file that we just created. So what I'm going to do here is we're going to run the command SSH dash I. And then we're going to give it the name of our pen file. So our our pen file was this one here. So private dash subnet, dash demo dot pen file. You can alternatively put the path name here. If you're doing this from a path that is not where you download the file, you can see I'm in the downloads folder, which is why I will not have to do that. Then what you want to do is do dash L for login and you want to say EC2 dash user. And then you just want to paste in the IP address, the public IP address, like you can see up over here. And if everything worked correctly, you just have to type yes in here. If you get this prompt, you should see that we are now in this EC2 instance. So we're at the EC2 prompt here. You can do whatever you want. There's no files here. You can create a file and do whatever you want in this instance. But for our case, it's just going to act as a way for us to get access to our RDS instance, which we are going to create basically right now. So let's go into the RDS section of the AWS console. You may want to just put your public IP address in your clipboard or off to the side here because we're going to need that in a couple minutes. So let's go to RDS now. And I'm doing this. I'm going to be doing this with Aurora, but it will work for any other type of RDS instance that you create, whether that be Aurora, whether that be Postgres or my sequel or Oracle or Microsoft SQL server. The port may be slightly different because typically Postgres is on 5432 and the other database instances are on typically different ports. So that may change, but the network stuff is going to predominantly be pretty much exactly the same. So remember in the beginning, we created two different private subnets. One was in availability zone 1a and one was in availability zone 1b. Now the reason that's important is because there's this concept here called subnet groups and subnet groups are collections of subnets. So when you launch your RDS instance, you need to specify a subnet group of which group of subnets are you going to place your RDS instance into and by default, RDS requires you to have your subnets located in two different availability zones. Now they don't explicitly say why this is required, but my suspicion is that RDS has this feature called multi region failover or multi AZ availability. So you can place different instances in different subnets. And if something goes wrong with, you know, the availability zone where your primary is located in, it can fail over to a different availability zone. So that's why I believe that they have this set to be at least two availability zones per subnet group. So I hope that made sense. Let's go ahead and create the subnet group. Now you can see I had a private one that I created earlier, but we're going to create a brand new one as well. So let's go to create subnet group. And we're going to call this one private group. So that's good. You need to put in the description as well or also won't work for VPC. Make sure you select the correct VPC here for availability zones. You need to select both 1a and 1b because that's where both of our private subnets that we selected earlier when we created them. So click on 1a 1b and then for subnets you want to pick the ones I believe it's the bottom. Yeah, the top one here. This is our public subnet. And this one here is also our public subnet. And you can tell because this one has dot 96 and this one has dot 112. So these two that I'm selecting are both of our private subnets, which is exactly what we want here. So we selected those go ahead and click on create now. All right, so we have the subnet group called private group here. We're going to refer to this when we create our database basically right now. So go to databases in the top left here and we are going to create a database. And let me just close this junk because real estate is at a premium. And we're just going to wait for this to load for some reason. This has been really slowly for AWS to create a new database. So yeah, okay, there we go. All right, we're going to create a database. We're going to leave it as standard create. I'm going to select Aurora. And by the way, if you're using Aurora here, this will work for the serverless version as well. So it doesn't really matter if you're using provision or serverless. This works exactly the same. We're going to do this with post grass sequel. Okay, that's fine. We're going to leave it on the default version. Put it to dev test so we don't have like any crazy features enabled here. You can leave this as default version. Master user name post grass. You should probably change this. I'm just going to do like completely stupid things here. So I'm giving my password literally called password. But I'm going to delete all this stuff later. So it doesn't really matter. For instance type, I'm just going to select a provision one for now. But you can easily do this with serverless as well. So yeah, T3 medium is fine. Okay. And this is the feature that I was talking about earlier. So multi AZ deployment. So create an Aurora replica reader in a different AZ, which is recommended for scaled availability. That's why we need that subnet group that crosses both of these availability zones. But we're not going to do that in this instance. So make sure that you click on that. All right. So connectivity. This is kind of important. So in recent years or recent months, AWS has attempted to make this easier for you to create jump boxes. And as you can tell, they are giving you this wizard here that is kind of showing you are making it easier for you to do this by like giving you as part of the wizard itself, you know, which instance do you want to connect to all that stuff. You can do this, but it doesn't actually teach you anything about what's going on. And if you're ever stuck in a situation where you need to debug something, you're going to have no idea what to do. So I recommend that you know, if you know what you're doing, you can use this because it's easy and it sets it up quickly. But if this is your first time you're trying to learn, follow my steps here because this is going to teach you the fundamentals in addition to getting you set up for success. All right. So we're going to leave this on don't connect and we're going to do it ourselves very scary, but not so much you'll see. All right. So virtual private cloud, make sure this is set to your VPC. That's fine. The subnet group. This is what we just created in the previous step. So we need to change this to private group. This is the one that we just created for public access. Very important set this to know because we don't want to give it public access. We don't want it to have a public IP address or else we're going to be in trouble here. So leave this as no. All right. So that's good. And for VPC security group. So this is where we need to specify a security group that's going to allow connections from our EC2 host that's in our public subnet. So we're not going to use the default VPC security group. We're going to create our own here. If we can. Okay. There we go. Create new. So let's call this private subnet, dash subnet, dash RDS, dash SG. I have so many of these. I'm probably going to get confused. I'm going to copy this to my clipboard just in case. For availability zone, we're going to place this in one a you can see it's restricting our selection now to whatever we created in the subnet group. So we're just going to select one a here. This is looking good additional configuration, port 5432. That's fine. We don't need anything else here. Turn off performance insights. We don't get charged more. We don't need an additional database or initial one. So go ahead and click on create database now. And to set up the database, it sometimes takes. Okay. Thank you. Can you just stop? Like just stop it. All right. So sometimes this takes a couple minutes for this to set up correctly. But in the meantime, we can go ahead and start modifying that security group. So you can see like this is creating it'll take a little while. So let's go into our instance now and play with that security group itself. All right. So let's go into it. And here's the security group that we just created. I'm just going to open this in a new tab because I want to keep our RDS page open. So let's go over here now. And so yeah, this is our private subnet RDS security group. And okay. So make sure that you have it selected here. So you have the check box selected. And down here, we need to change some of the inbound rules. So go to inbound rules. And we're going to go to edit inbound rules over here on the right hand side. And so this default rule here just has my public IP address listed. But we need to, like this isn't going to be effective because this isn't a private subnet. So we're not going to be able to talk to this instance directly anyway. So this doesn't really matter. This rule here. You can delete it if you want. But what we need to do here is we need to add a new rule. And what we need to do is similarly, we need to say Postgres SQL. And so if you're using something like my SQL, for example, you'd want to select the corresponding one. But we're using Postgres. So we're going to click on that. And then we want to change this. And we want to change in this box here. And we want to find the name of the security group of our EC2 instance that we created and one of those first steps. So I see the name and I'll remember it. Yes, it was jump box, dash SG. So by selecting this and by clicking on save rules now, we're effectively saying that this instance is allowed to receive inbound inbound connections using this protocol from this instance. So from the EC2 instance, we created in the previous step. So if you don't do this, then you're not going to get the permissions for your EC2 instance to talk to your RDS database. And when you try to SSH tunnel from your home machine, you're going to have a network failure here. And this whole thing is not going to work. So make sure you do this step or else you're going to get stuck and you're not going to know what's wrong. This is by far the most common place where people get confused. So go ahead and click on save rules now. This just takes a moment. All right, cool. We're done here. And okay, so our instance still looks to be creating. Let's just refresh this. Yeah, so it's still creating. I'm going to come back in a moment or so when this is done. And we're going to test this thing and to end. So see you in a minute. All right, everyone. So we are ready to connect. So you can see here our instance is currently it's configuring enhanced monitoring, but we don't need to wait for that. We can connect to it right now. And what we need to do in order to connect to it from our home machine is we need to grab its DNS. So go into the instance and you can see the endpoint is right here. So I'm just going to copy this to my clipboard because we're going to need this in order to form our SSH tunnel. All right. So go back either into your terminal or into PowerShell because we're going to be running a new command here. And if you're still in your EC2 machine from earlier earlier, you can just type type exit and you know that'll clear you up. All right. So we're going to type in a slightly different command. This is going to form an SSH tunnel using our EC2 instance into our RDS instance. So follow along with me here. All right. So we're going to do SSH dash i. And then I believe mine was like private, yeah, private subnet demo dash dot pen. And then we're going to do dash f dash capital N and then dash L. Yep. A lot of settings here. I realize that. And then we're going to say 5 4 3 2. And we're going to do colon and then paste the DNS that you just came up with actually didn't save to my clipboard for some reason. So I'm just going to go back and grab this and just paste that in there. All right. So that's the DNS of the private DNS of your RDS instance. And then again, we're going to say port 5 4 3 2. And we're going to need to give it some information on our bastion host or our jump box as well. So we're going to say EC2 dash user at. And then the IP address of our EC2 instance. So mine was 5 4.81 dot 217 dot 121 and then finally do dash V. And you should see something similar to what I just put in here. And the final line should be something along the lines of forking into the background. So we now have an SSH tunnel form to between our home machine, our EC2 instance and our RDS instance that's hosting the database. So we should be able to interact with our postgres instance now. So let's boot up PG admin. And I'm going to try and create a new server or create a new database connection rather. So we're going to register a new one. And you can just name this whatever you want. So my RDS and servers. Okay. Go into connection. And for host name, this is going to be on local host because we're using SSH tunneling. It's as if our RDS instance, which is currently located in AWS is on our local machine. So we're going to be on port 5 4 3 2. The main database name that's fine username postgres. If you change this, make sure you change it as well. My password was just password. And if we click on save here, we should see. Yep, there was no error message. So we now have access to our database here. So you have access to your postgres database. You can create new tables here if you want. Edit anything as if this RDS machine was on your local machine. Now one pro tip that you need to remember is that if you want to interact with your RDS instance, you're going to need to go back to PowerShell or terminal and run this command each and every time. You can just leave this on the background. It'll last for hours on end. But make sure you do this before you try and connect to it or else it won't work. So I hope this video was useful. And if you enjoyed it, please let me know down in the description section below. And thanks so much for watching. I'll see you next time.
